const { build } = require('esbuild');
const path = require('path');

const rootDir = path.resolve(__dirname, '..');

const optionalExternals = [
	'arc-templates/dist/es5',
	'atpl',
	'babel-core',
	'bracket-template',
	'coffee-script',
	'dot',
	'dust',
	'dustjs-helpers',
	'dustjs-linkedin',
	'eco',
	'ect',
	'ejs',
	'haml-coffee',
	'hamlet',
	'hamljs',
	'handlebars',
	'hogan.js',
	'htmling',
	'jade',
	'jazz',
	'jqtpl',
	'just',
	'liquid-node',
	'liquor',
	'lodash',
	'marko',
	'mote',
	'mustache',
	'nunjucks',
	'plates',
	'pug',
	'qejs',
	'ractive',
	'razor-tmpl',
	'react',
	'react-dom/server',
	'slm',
	'squirrelly',
	'swig',
	'swig-templates',
	'teacup/lib/express',
	'templayed',
	'then-jade',
	'then-pug',
	'tinyliquid',
	'toffee',
	'twig',
	'twing',
	'underscore',
	'vash',
	'velocityjs',
	'walrus',
	'whiskers',
];

const externals = ['vscode', ...optionalExternals];

build({
	entryPoints: [path.join(rootDir, 'src', 'extension.ts')],
	bundle: true,
	platform: 'node',
	format: 'cjs',
	target: ['es2020'],
	sourcemap: false,
	minify: true,
	outfile: path.join(rootDir, 'dist', 'extension.js'),
	external: externals,
	logLevel: 'info',
}).catch(() => process.exit(1));
